# Akkatecture Documents CI CD pipeline definition
# This definition is responsible for building and releasing
# the project within the context of pull requests. as a
# static build it only builds and tests the project.

trigger:
- master

variables:
  majorVersion: '0'
  minorVersion: '1'
  dayOfYear: $(DayOfYear)
  revision: $(Rev:r)
  patchVersion: ${{ format('{0}{1}', variables.dayOfYear, variables.revistion) }}

name: ${{ format('{0}.{1}.{2}', variables.majorVersion, variables.minorVersion, variables.patchVersion) }}


jobs:
  - job: Build
    pool:
      vmImage: 'Ubuntu 16.04'
    variables:
      buildConfiguration: 'Release'

    steps:
    - task: InstallSSHKey@0
      displayName: 'Install SSH Key'
      inputs:
        hostName: 'github.com'
        sshPublicKey: 'ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDtR/A7yrgMiL7GZpXX+UEMPzomBwrtYfWqcd+L8KRNQ2wNuyqSOGtlZZH2imBiBObONzNE1Zst0F+y7Fu0RjalMJ5OJIKyNb0sPMKdx3g3h+p8MRWUuap5AtjyKynCE/0jOFZAHZHLie3PDqRylKdxXK6IZkddDXIDOrq6djvX7lzjbpoGGx+VGbF8vVkfc0h+Uxd9p3oHkS8I1V8KGcA+YdZSQ1b7Z8QaUax6e9DjQWHoEEUhe6JYu1PK/6TYim3vnL0ns9/+P6YkTMpqcYyIn6aZiM+XYhCspN2LlQhc/iSqCOpSN5XZrIkuE116hV+aIUdbZ05QocvRnb/HuErtlhpDz67Sgm81AW/Wl3JHSx1Sj//2Elpiu9UkkG3Jf7Ux7tcJbZCR9IY8Hh+pQ/1AaOM9DEdHc7F5jLIgiemjwuU9EkqwLJ5rysq63KiJgGxtjKXnsw6CnxnEFwgaLVS7M5TsaKBxE8R4Mj9JNzLo5hC5OwHTygr8FSsE6D2PEyqGSz3X++P1rMilLH+MvDfwteJ2R2N9D4P0MfWuuqcknVlhjxHwQmEbeCbVo3IJLy8n/JGog1AQEusfP/O3RFwUZFkDlvrRi7efGBjbAQHgmr47Zjl73sRNsX6ebkc8Z4EGT9hnOdvONMA7zAq5j5CCSc5XBcFD8srIOHWKithlgQ== Deployment key for Azure Dev Ops to deploy to Akkatecture.github.io'
        sshKeySecureFile: 'id_azuredevops_github'

    - task: NodeTool@0
      inputs:
        versionSpec: '8.16.0'

    - script: 'ssh-add -L'

    - script: 'git remote remove origin'
      displayName: 'Remove Origin [Documentation]' 

    - script: 'git remote add origin git@github.com:Akkatecture/Akkatecture.github.io.git'
      displayName: 'Set Origin [Akkatecture.github.io]'

    - script: 'git remote -v'

    - script: 'npm install -g gatsby-cli'

    - script: 'npm install'
    
    - script: 'npm run deploy'